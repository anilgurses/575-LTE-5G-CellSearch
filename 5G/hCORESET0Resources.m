%hCORESET0Resources CORESET 0 resources
%   [NRB,NSYM,OFFSET,MUXPATTERN,TAB] = ...
%           hCORESET0Resources(INDEX,SCS,MINCHANBW,KSSB) returns CORESET 0
%   resources parameters from TS 38.213 Section 13 Tables 13-1 to 13-10
%   corresponding to a row index INDEX (4 MSBs of PDCCH-ConfigSIB1 in MIB).
%   The table is selected using the two-element vector SCS ([SSB,COMMON]),
%   the minimum channel bandwidth MINCHANBW and SSB subcarrier offset KSSB.
%   For information on MINCHANBW, see TS 38.101-1 Table 5.3.5-1.

%   Copyright 2020-2021 The MathWorks, Inc.

function [nrb,nsym,offset,muxPattern,tab] = hCORESET0Resources(index,scs,minChanBW,kSSB)

    if nargin == 3
        kSSB = 0;
    end

    % Frequency Range 1
    if all(scs == [15 15])
        tab = [ 0   1   2   3   4   5   6   7   8   9  10  11  12  13  14   15;...
                1   1   1   1   1   1   1   1   1   1   1   1   1   1   1  NaN;...
               24  24  24  24  24  24  48  48  48  48  48  48  96  96  96  NaN;...
                2   2   2   3   3   3   1   1   2   2   3   3   1   2   3  NaN;...
                0   2   4   0   2   4  12  16  12  16  12  16  38  38  38  NaN];
    elseif all(scs == [15 30])
        tab = [ 0   1   2   3   4   5   6   7   8   9  10  11  12  13  14   15;...
                1   1   1   1   1   1   1   1   1   1   1   1   1   1  NaN NaN;...
               24  24  24  24  24  24  24  24  48  48  48  48  48  48  NaN NaN;...
                2   2   2   2   3   3   3   3   1   1   2   2   3   3  NaN NaN;...
                5   6   7   8   5   6   7   8  18  20  18  20  18  20  NaN NaN];
    elseif all(scs == [30 15])
        if any(minChanBW == [5,10])
            tab = [ 0   1   2   3   4   5   6   7   8   9:15;...
                    1   1   1   1   1   1   1   1   1   NaN(1,7);...
                   48  48  48  48  48  48  96  96  96   NaN(1,7);...  
                    1   1   2   2   3   3   1   2   3   NaN(1,7);...  
                    2   6   2   6   2   6  28  28  28   NaN(1,7)];
        elseif minChanBW == 40
            tab = [ 0   1   2   3   4   5   6   7   8   9:15;...
                    1   1   1   1   1   1   1   1   1   NaN(1,7);...
                   48  48  48  96  96  96  96  96  96   NaN(1,7);...
                    1   2   3   1   1   2   2   3   3   NaN(1,7);...
                    4   4   4   0  56   0  56   0  56   NaN(1,7)];
        end
    elseif all(scs == [30 30])
        if any(minChanBW == [5,10])
            tab = [0   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15;...
                   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1;...
                  24  24  24  24  24  24  24  24  24  24  48  48  48  48  48  48;...
                   2   2   2   2   2   3   3   3   3   3   1   1   1   2   2   2;...
                   0   1   2   3   4   0   1   2   3   4  12  14  16  12  14  16];
        elseif minChanBW == 40
            tab = [0   1   2   3   4   5   6   7   8   9  10:15;...
                   1   1   1   1   1   1   1   1   1   1  NaN(1,6);...
                  24  24  24  24  48  48  48  48  48  48  NaN(1,6);...
                   2   2   3   3   1   1   2   2   3   3  NaN(1,6);...
                   0   4   0   4   0  28   0  28   0  28  NaN(1,6)];
        end

    % Frequency Range 2
    elseif all(scs == [120 60])
        tab = [ 0   1   2   3   4   5   6   7   8   9  10  11  12:15;...
                1   1   1   1   1   1   1   1   2   2   2   2  NaN(1,4);...
               48  48  48  48  48  48  96  96  48  48  96  96  NaN(1,4);...
                1   1   2   2   3   3   1   2   1   1   1   1  NaN(1,4);...
                0   8   0   8   0   8  28  28 -41  49 -41  97  NaN(1,4)];
        if kSSB > 0
            idx = tab(1,:);
            tab(5,idx==8) = -42;
            tab(5,idx==10) = -42;
        end
    elseif all(scs == [120 120])
        tab = [ 0   1   2   3   4   5   6   7  8:15;...
                1   1   1   1   3   3   3   3  NaN(1,8);...
               24  24  48  48  24  24  48  48  NaN(1,8);...
                2   2   1   2   2   2   2   2  NaN(1,8);...
                0   4  14  14 -20  24 -20  48  NaN(1,8)];
        if kSSB > 0
          idx = tab(1,:);
          tab(5,idx==4) = -21;
          tab(5,idx==6) = -21;
        end
    elseif all(scs == [240 60])
        tab = [0   1   2   3  4:15;...
               1   1   1   1  NaN(1,12);...
              96  96  96  96  NaN(1,12);...
               1   1   2   2  NaN(1,12);...
               0  16   0  16  NaN(1,12)];

    elseif all(scs == [240 120])
        tab = [ 0   1   2   3   4   5   6   7  8:15;...
                1   1   1   1   2   2   2   2  NaN(1,8);...
               48  48  48  48  24  24  48  48  NaN(1,8);...
                1   1   2   2   1   1   1   1  NaN(1,8);...
                0   8   0   8 -41  25 -41  49  NaN(1,8)];
        if kSSB > 0
            idx = tab(1,:);
            tab(5,idx==4) = -42;
            tab(5,idx==6) = -42;
        end
    else
        error('SSB block pattern and common subcarrier spacing combination not supported. For Case A/B/C, common subcarrier spacing can be 15 or 30 kHz. For Case D/E, common subcarrier spacing can be 60 or 120 kHz.')
    end

    t = tab(:,index==tab(1,:));
    muxPattern = t(2);
    nrb = t(3);
    nsym = t(4);
    offset = t(5);

    tab = tab';

end